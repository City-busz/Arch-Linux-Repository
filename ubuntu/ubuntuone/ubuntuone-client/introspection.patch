=== modified file 'configure.ac'
--- configure.ac	2010-10-19 13:51:11 +0000
+++ configure.ac	2010-11-17 20:35:14 +0000
@@ -164,6 +164,15 @@
 # Check for introspection
 ##################################################
 GOBJECT_INTROSPECTION_CHECK([0.6.4])
+AC_MSG_CHECKING([if gobject-introspection requires new options])
+$PKG_CONFIG --atleast-version=0.9.4 gobject-introspection-1.0
+new_introspection=$?
+if test "x$new_introspection" = "x0"; then
+   AC_MSG_RESULT([yes])
+else
+   AC_MSG_RESULT([no])
+fi
+AM_CONDITIONAL([HAVE_NEW_INTROSPECTION], [test "x$new_introspection" = "x0"])
 
 # Fix up some junk from GIR
 if test "x$found_introspection" = "xyes"; then

=== modified file 'libsyncdaemon/Makefile.am'
--- libsyncdaemon/Makefile.am	2010-10-11 13:28:12 +0000
+++ libsyncdaemon/Makefile.am	2010-11-17 20:35:14 +0000
@@ -67,7 +67,7 @@
 libsyncdaemon_1_0_la_LDFLAGS = -version-info $(LIBSYNCDAEMON_CURRENT):$(LIBSYNCDAEMON_REVISION):$(LIBSYNCDAEMON_AGE)
 
 test_libsyncdaemon_SOURCES = test-libsyncdaemon.c
-test_libsyncdaemon_LDADD = libsyncdaemon-1.0.la
+test_libsyncdaemon_LDADD = libsyncdaemon-1.0.la $(DBUS_LIBS)
 
 pkgconfigdir = $(libdir)/pkgconfig
 pkgconfig_DATA = libsyncdaemon-1.0.pc
@@ -80,14 +80,19 @@
 
 -include $(INTROSPECTION_MAKEFILE)
 INTROSPECTION_GIRS =
+INTROSPECTION_COMPILER_ARGS = --includedir=$(srcdir)
 INTROSPECTION_SCANNER_ARGS = --add-include-path=$(srcdir)
-INTROSPECTION_COMPILER_ARGS = --includedir=$(srcdir)
+
+if HAVE_NEW_INTROSPECTION
+INTROSPECTION_SCANNER_ARGS += --identifier-prefix=Syncdaemon
+endif
 
 if HAVE_INTROSPECTION
 introspection_files =				\
 	$(syncdaemoninclude_HEADERS)		\
         $(shell ls syncdaemon*.[ch])
 SyncDaemon-1.0.gir: libsyncdaemon-1.0.la Makefile
+SyncDaemon_1_0_gir_NAMESPACE = SyncDaemon
 SyncDaemon_1_0_gir_INCLUDES = GObject-2.0
 SyncDaemon_1_0_gir_CFLAGS = -I$(top_srcdir) -I$(top_builddir)
 SyncDaemon_1_0_gir_LIBS = libsyncdaemon-1.0.la

=== modified file 'po/POTFILES.skip'
--- po/POTFILES.skip	2010-06-11 15:33:16 +0000
+++ po/POTFILES.skip	2010-11-17 20:35:14 +0000
@@ -1,3 +1,4 @@
 contrib/mocker.py
 tests/syncdaemon/test_hashqueue.py
+tests/syncdaemon/test_vm.py
 ubuntuone/__init__.py


# Maintainer: György Balló <ballogy@freestart.hu>
pkgname=indicator-touchpad
_pkgname=touchpad-indicator
pkgver=0.7.2
pkgrel=1
pkgdesc="An indicator to show the status of the touchpad, and to enable and disable the touchpad"
arch=('any')
url="https://launchpad.net/touchpad-indicator"
license=('GPL')
depends=('indicator-application' 'dbus-python' 'python2-gconf' 'python-notify' 'python-usb')
source=(http://launchpad.net/$_pkgname/trunk/$pkgver/+download/${_pkgname}_$pkgver.orig.tar.gz
        configfix.patch)
md5sums=('4a75be9bba65dbeeaee22e35af5f60f8'
         'abe7fbbe1afed311dcefb8baa648b27d')

build() {
  cd "$srcdir"

  sed -i 's@^#!.*python$@#!/usr/bin/python2@' *.py
  patch -Np0 -i "$srcdir/configfix.patch"
  sed -i '49,49 a pynotify.init("Touchpad Indicator")' touchpad-indicator.py
  sed -i "s|LANGDIR =.*|LANGDIR = '/usr/share/locale'|" com.py
}

package() {
  cd "$srcdir"

  # Build the sctructure
  mkdir -p "$pkgdir"/usr/share/{applications,pixmaps,touchpad-indicator}
  mkdir -p "$pkgdir"/usr/share/locale/{de,en,es,fr,gl,it}/LC_MESSAGES

  # Copy files
  cp change_touchpad_state.py "$pkgdir/usr/share/touchpad-indicator/"
  cp com.py "$pkgdir/usr/share/touchpad-indicator/"
  cp configurator.py "$pkgdir/usr/share/touchpad-indicator/"
  cp devices.py "$pkgdir/usr/share/touchpad-indicator/"
  cp preferences.py "$pkgdir/usr/share/touchpad-indicator/"
  cp touchpad-indicator.py "$pkgdir/usr/share/touchpad-indicator/"
  cp touchpad-indicator.svg "$pkgdir/usr/share/touchpad-indicator/"
  cp touchpad-indicator-disabled.svg "$pkgdir/usr/share/touchpad-indicator/"
  cp touchpad-indicator.svg "$pkgdir/usr/share/pixmaps/"
  cp touchpad-indicator-disabled.svg "$pkgdir/usr/share/pixmaps/"
  cp touchpad-indicator.py.desktop "$pkgdir/usr/share/touchpad-indicator/"
  cp Touchpad-Indicator.desktop "$pkgdir/usr/share/applications/"

  # Make language files
  msgfmt de.po -o "$pkgdir/usr/share/locale/de/LC_MESSAGES/touchpad-indicator.mo"
  msgfmt en.po -o "$pkgdir/usr/share/locale/en/LC_MESSAGES/touchpad-indicator.mo"
  msgfmt es.po -o "$pkgdir/usr/share/locale/es/LC_MESSAGES/touchpad-indicator.mo"
  msgfmt fr.po -o "$pkgdir/usr/share/locale/fr/LC_MESSAGES/touchpad-indicator.mo"
  msgfmt gl.po -o "$pkgdir/usr/share/locale/gl/LC_MESSAGES/touchpad-indicator.mo"
  msgfmt it.po -o "$pkgdir/usr/share/locale/it/LC_MESSAGES/touchpad-indicator.mo"
}

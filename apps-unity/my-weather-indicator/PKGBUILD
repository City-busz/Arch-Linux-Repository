# Maintainer: György Balló <ballogy@freestart.hu>
pkgname=my-weather-indicator
pkgver=0.4.3.14
pkgrel=1
_pkgrel=1ubuntu1
pkgdesc="A simple indicator for the weather"
arch=('any')
url="https://launchpad.net/my-weather-indicator"
license=('GPL')
depends=('pycrypto' 'python2-dateutil' 'dbus-python' 'python2-gobject' 'python-lxml' 'libappindicator3' 'libnotify' 'dconf' 'hicolor-icon-theme' 'xdg-utils')
install=$pkgname.install
source=(https://launchpad.net/~atareao/+archive/atareao/+files/${pkgname}_$pkgver-$_pkgrel.tar.gz)
md5sums=('e41411e0a6376df97aefc8176936e13a')

build() {
  cd "$srcdir/$pkgname"

  sed -i 's@^#!.*python$@#!/usr/bin/python2@' src/*.py
  sed -i "s|LANGDIR =.*|LANGDIR = '/usr/share/locale'|" src/commwi.py
  sed -i 's/lsb_release -a/uname -sr/' src/machine_information.py
}

package() {
  cd "$srcdir/$pkgname"

  # Build the sctructure
  mkdir -p "$pkgdir"/usr/{bin,share/{my-weather-indicator,applications,glib-2.0/schemas,icons/hicolor/{48x48,24x24}/status,pixmaps}}
  mkdir -p "$pkgdir"/usr/share/locale/{ca@valencia,en,fr,ca,lt,tr,de,cs,nl,hr,it,fi,pt_BR,sk,ru,en_GB,gl,es,pl,sl,lv,el,zh_CN,ro,hu,sv,uk,ar,zh_TW,ta,vi,et,eu,te}/LC_MESSAGES

  # Copy files
  cp bin/* "$pkgdir/usr/bin"
  cp src/* "$pkgdir/usr/share/my-weather-indicator"
  cp data/my-weather-indicator-autostart.desktop "$pkgdir/usr/share/my-weather-indicator"
  cp data/My-Weather-Indicator.desktop "$pkgdir/usr/share/applications"
  cp data/apps.indicators.my-weather-indicator.gschema.xml "$pkgdir/usr/share/glib-2.0/schemas"
  cp data/images/*.png "$pkgdir/usr/share/icons/hicolor/48x48/status"
  cp data/icons/*.png "$pkgdir/usr/share/icons/hicolor/24x24/status"
  cp data/images/my-weather-indicator.png "$pkgdir/usr/share/pixmaps"

  # Build language files
  msgfmt template1/ca@valencia.po -o "$pkgdir/usr/share/locale/ca@valencia/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/en.po -o "$pkgdir/usr/share/locale/en/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/fr.po -o "$pkgdir/usr/share/locale/fr/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/ca.po -o "$pkgdir/usr/share/locale/ca/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/lt.po -o "$pkgdir/usr/share/locale/lt/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/tr.po -o "$pkgdir/usr/share/locale/tr/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/de.po -o "$pkgdir/usr/share/locale/de/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/cs.po -o "$pkgdir/usr/share/locale/cs/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/nl.po -o "$pkgdir/usr/share/locale/nl/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/hr.po -o "$pkgdir/usr/share/locale/hr/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/it.po -o "$pkgdir/usr/share/locale/it/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/fi.po -o "$pkgdir/usr/share/locale/fi/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/pt_BR.po -o "$pkgdir/usr/share/locale/pt_BR/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/sk.po -o "$pkgdir/usr/share/locale/sk/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/ru.po -o "$pkgdir/usr/share/locale/ru/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/en_GB.po -o "$pkgdir/usr/share/locale/en_GB/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/gl.po -o "$pkgdir/usr/share/locale/gl/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/es.po -o "$pkgdir/usr/share/locale/es/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/pl.po -o "$pkgdir/usr/share/locale/pl/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/sl.po -o "$pkgdir/usr/share/locale/sl/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/lv.po -o "$pkgdir/usr/share/locale/lv/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/el.po -o "$pkgdir/usr/share/locale/el/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/zh_CN.po -o "$pkgdir/usr/share/locale/zh_CN/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/ro.po -o "$pkgdir/usr/share/locale/ro/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/hu.po -o "$pkgdir/usr/share/locale/hu/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/sv.po -o "$pkgdir/usr/share/locale/sv/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/uk.po -o "$pkgdir/usr/share/locale/uk/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/ar.po -o "$pkgdir/usr/share/locale/ar/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/zh_TW.po -o "$pkgdir/usr/share/locale/zh_TW/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/ta.po -o "$pkgdir/usr/share/locale/ta/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/vi.po -o "$pkgdir/usr/share/locale/vi/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/et.po -o "$pkgdir/usr/share/locale/et/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/eu.po -o "$pkgdir/usr/share/locale/eu/LC_MESSAGES/my-weather-indicator.mo"
  msgfmt template1/te.po -o "$pkgdir/usr/share/locale/te/LC_MESSAGES/my-weather-indicator.mo"
}
